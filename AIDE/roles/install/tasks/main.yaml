- name: Installing Aide
  apt:
    name: aide
    state: present

- name: Copying Config File
  command: cp /etc/aide/aide.conf .

- name: Configuring Aide
  blockinfile:
    path: /etc/aide/aide.conf
    block: |
      !/bin
      !/boot
      !/cdrom
      !/dev
      !/home
      !/lib
      !/lib32
      !/lib64
      !/libx32
      !/lost+found
      !/media
      !/mnt
      !/opt
      !/proc
      !/root
      !/run
      !/sbin
      !/snap
      !/srv
      !/swap.img
      !/sys
      !/tmp
      !/usr
      !/var
      ### Add path to files to check ###
      /etc/ Full

- name: Updating Config File
  command: "{{item}}"
  loop:
    - update-aide.conf
    - cp /var/lib/aide/aide.conf.autogenerated /etc/aide/aide.conf

- name: Initializing Aide
  command: aideinit

- name: Copying Databases
  command: cp /var/lib/aide/aide.db.new /var/lib/aide/aide.db

- name: Checking Files Integrity
  command: aide -c /etc/aide/aide.conf --check
  register: output
  failed_when: output.rc != 0 and output.rc != 4 and output.rc != 7
- debug: msg="{{output.stdout_lines}}"
